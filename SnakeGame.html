<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game</title>
    <link href='https://fonts.googleapis.com/css?family=Comfortaa' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

</head>

    <style>

        body{
            background-color: rgb(0, 0, 0);
        }
    
        #stage{
            margin-top: 0px;
            border: 6px solid transparent;
            border-image: linear-gradient(to bottom right, #b827fc 0%, #2c90fc 25%, #b8fd33 50%, #fec837 75%, #fd1892 100%);
            border-image-slice: 1;
            margin: 0, 10, 10, 10;
        }       
        
        #title{
            margin-top: 60px;
            color: rgb(255, 255, 255);
            font-family: Comfortaa;
            font-size: 25pt;
        }

        #score{
            color: white;
            font-family: Comfortaa;
            font-size: 30pt;
        }

        .leaderboard-title{
            color : white;
            font-size: 22pt;
            font-family: Comfortaa;
            margin-left: 150px;
            margin-top: 0px;
        }
        
        #leaderboard{
            color: white;
            font-family: Comfortaa;
            font-size: 15pt;
            margin-left: 50px;
        }

        #textBox{
            color: white;
            font-family: Comfortaa;
            width:400px;
            margin-left: 158px;
            font-size: 15pt;
        }  


    </style>

<body>
    

    <center>
        <h1 id="title">Snake Game</h1>
    </center>
    
    <div class="row">

        <div class="col l4 s4 m4">
            <h1 class="leaderboard-title">Enter your name here:</h1> 
            
            <input type="text" id="textBox" maxlength="10">
        </div>

        <div class="col l4 s4 m4">
            <center>
                <canvas id="stage" width="500" height="500"></canvas>
            </center>
        
            <center> <h1 id="score">Your score : 0</h1> </center>
        </div>

        <div class="col l4 s4 m4" id="leaderboard-div">
            <h1 class="leaderboard-title">Session Leaderboard : </h1>
            <ol type="" id="leaderboard">
               
            </ol>
        </div>
       
    </div>
    

    

    <script type="text/javascript">

        window.onload = function(){

            var stage = document.getElementById("stage");
            var ctx = stage.getContext("2d"); // Aqui acontecerá toda a parte visual do Jogo
            document.addEventListener("keydown", keyMap); // Espera com que o evento "keydown" seja ativado, e assim executa a função keymap 
            setInterval(game, 60); // faz com que a função game seja chamada a cada 60 milisegundos


            const vel = 1; // velocidade da cobra

            var vx = vy = 0; // iniciando a velocidade x e y da cobra com 0
            var px = py = 10; // local onde a cobra irá começar 
            var size = 20; // tamanho em px de cada quadrado
            var quantity = 25 // numero de quadrados no canvas 
            var appleX = appleY = 15; // posição inicial da maçã
            
            var snake = [];
            var tail = 2;
            started = false;

            var direction = " ";

            var score = 0;

            var leaderboard = [];
            var index = 0;

            function game() {
                
                px += vx; // } --> Inicializando a posição da cobra
                py += vy; // }

                if(px < 0) // se a cobra sair do stage
                {
                    px = quantity - 1; // cobra reaparece do outro lado do stage
                }
                if(px > quantity - 1) // se a cobra sair do stage
                {
                    px = 0; // cobra reaparece do outro lado do stage
                }
                if(py < 0) // se a cobra sair do stage
                {
                    py = quantity - 1; // cobra reaparece do outro lado do stage
                }
                if(py > quantity - 1) // se a cobra sair do stage
                {
                    py = 0; // cobra reaparece do outro lado do stage
                }
                
                
                ctx.fillStyle = "black"; // Escolhe a cor de fundo do stage
                ctx.fillRect(0, 0, stage.width, stage.height) ; // Preenche o stage com a cor de fundo escolhida 

                ctx.fillStyle = "red"; // Escolhe a cor da Maçã
                ctx.fillRect(appleX * size, appleY * size, size, size); // Preenche a posição da maçã com vermelho

                ctx.fillStyle = "gray"; // Escolhe a cor da cobra
                for(var i = 0; i < snake.length; i++)
                {
                    ctx.fillRect(snake[i].x * size, snake[i].y * size, size - 1, size - 1); // preenche os blocos onde a cobra esta com azul claro

                    if(px == snake[i].x && py == snake[i].y) // se a cabeça da cobra colidir com seu corpo
                    {
                        vx = vy = 0; // Para a cobra
                        tail = 2; // volta a cobra para o tamanho inicial
                         
                        if(started)
                        {
                            document.getElementById("score").innerHTML = "Your final score was : " + score; // diz ao usuário sua pontação final
                            started = false;
                            leaderboard[index] = {name: document.getElementById("textBox").value, score: score};
                            index++;
                            generateLeaderboard()
                        }

                      
                        


                        score = 0; // zera a pontuação 
                    } 
                }

                snake.push({x : px, y : py}) // faz a cobra se movimentar

                while (snake.length > tail) { // se o tamanho da cobra foi maior do que a cauda
                    snake.shift(); // tira o primeiro elemento do Array
                }

                if(px == appleX && py == appleY) // se a cobra pegar a maçã
                {
                    tail++; // a cauda da cobra aumenta
                    appleX = Math.floor(Math.random()*quantity); // Reposiciona a maçã
                    appleY = Math.floor(Math.random()*quantity); // Reposiciona a maçã
                    score++; // aumenta a pontuação do jogador
                    document.getElementById("score").innerHTML = "Your score : " + score; // Atualiza a pontuação do jogador
                }
                

            }

            function keyMap(event) // função responsável pela movimentação
            {
                
                switch(event.keyCode) { // dependendo da tecla pressionada
                    case 37: // left
                        if(!(direction == "right")) // Se a direção não for a oposta
                        {
                            vx = -vel; // movimenta para a esquerda
                            vy = 0;
                            started = true;  // Diz ao jogo que o usuário começou a jogar   
                            direction = "left"; // Muda o valor da váriavel que indica a direção
                        }


                    break;
                    case 38: // Up
                        if(!(direction == "down")) // Se a direção não for a oposta
                        { 
                            vy = - vel; // movimenta para cima
                            vx = 0;
                            started = true; // Diz ao jogo que o usuário começou a jogar
                            direction = "up"; // Muda o valor da váriavel que indica a direção
                        }
                    break;
                    case 39: // right
                        if(!(direction == "left")) // Se a direção não for a oposta
                        {
                            vx = vel; // movimenta para a direita
                            vy = 0;
                            started = true; // Diz ao jogo que o usuário começou a jogar
                            direction = "right"; // Muda o valor da váriavel que indica a direção
                        }
                       
                    break;
                    case 40: // down
                        if(!(direction == "up")) // Se a direção não for a oposta
                        {
                            vy = vel; // movimenta para baixo
                            vx = 0;
                            started = true; // Diz ao jogo que o usuário começou a jogar
                            direction = "down"; // Muda o valor da váriavel que indica a direção
                        }
                        
                    break;
                }
            }    
            
            function generateLeaderboard()
            {
                leaderboard.sort(compare);
                leaderboard.reverse();
                var html = " ";
                for(var i = 0; i < leaderboard.length; i++)
                {
                    html += "<li>" + leaderboard[i].name + " with "+ leaderboard[i].score + " points.</li>";
                }
                
                document.getElementById("leaderboard").innerHTML = html;
            }

            function compare(a, b)
            {
                if(a.score > b.score)
                    return 1;

                if(a.score < b.score)
                    return -1;

                if(a.score == b.score)
                return 0;
            }
        }

    </script>

</body>
</html>